<!DOCTYPE html>
<html lang="en">
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <style>
    circle {
      fill: lightblue;
      stroke: black;
    }
  </style>
  <body onload="init()">
    <form action="/scene2.html">
      <button type="submit">Scene 2</button>
    </form>
    <form action="/scene3.html">
      <button type="submit">Scene 3</button>
    </form>
    <svg width="1000" height="1000"></svg>
    <script>
      async function init() {
        const data = await d3.csv("https://melindatsay.github.io/ppp_data.csv");
        const barHeight = 25;
        const marginTop = 30;
        const marginRight = 0;
        const marginBottom = 10;
        const marginLeft = 30;
        const width = 928;
        const height =
          Math.ceil((data.length + 0.1) * barHeight) + marginTop + marginBottom;

        // Create the scales.
        const x = d3
          .scaleLinear()
          .domain([0, d3.max(data, (d) => d.LoanAmount)])
          .range([marginLeft, width - marginRight]);

        const y = d3
          .scaleBand()
          .domain(
            d3.sort(data, (d) => -d.LoanAmount).map((d) => d.NAICSCode_2_sector)
          )
          .rangeRound([marginTop, height - marginBottom])
          .padding(0.1);

        d3.select("svg")
          .append("g")
          .attr("transform", "translate(50,50)")
          .selectAll("rect")
          .data(data)
          .enter()
          .append("rect")
          .attr("x", x(0))
          .attr("y", function (d) {
            return y(d.NAICSCode_2_sector);
          })
          .attr("width", function (d) {
            return x(d.LoanAmount) - x(0);
          })
          .attr("height", y.bandwidth());

        d3.select("svg")
          .append("g")
          .attr("transform", "translate(50,50)")
          .call(
            d3
              .axisLeft(y)
              .tickValues([10, 20, 50, 100])
              .tickFormat(d3.format("~s"))
          );

        d3.select("svg")
          .append("g")
          .attr("transform", "translate(50,250)")
          .call(
            d3
              .axisBottom(x)
              .tickValues([10, 20, 50, 100])
              .tickFormat(d3.format("~s"))
          );
      }
    </script>
  </body>
</html>
